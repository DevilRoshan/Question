# 前端动画/动效方案

> 工作中会遇到前端需要实现动态效果或者动画等需求，面对这类需求，很多开发人员觉得无从下手，觉得需求很困难。随着动画需求越来越多，以下便罗列出几种前端动画的实现方式，后续会继续补充

**本内容仅提供方案，相关API，相关库，相关demo自行探索**

## 什么是动画？

### 视觉暂留

医学证明人类具有“视觉暂留”的特性，人的眼睛看到一幅画或一个物体后，在0.34秒内不会消失。利用这一原理，在一幅画还没有消失前播放下一幅画，就会给人造成一种流畅的视觉变化效果。

### 要素

* 由起始状态到结束状态轨迹生成的一系列图像帧[画面]
* 每隔一定时间播放[切换]这些图像帧[画面]

## 动画方案

根据刚才所说的动画原理，我们将动画分为一系列图像帧和一个播放器，这些帧和播放器在js有不同的实现，由此衍生出一些方案。

### 简单动画/动效

简单动画/动效的实现相对简单，只需要考虑动态元素的起始状态和结束状态，中间的轨迹和播放器都是工具提供一些相关API

#### css transition

* transition是css中过渡效果，将元素某一个属性的变化由直接更改转换为慢慢过渡。
* 比如，修改定位元素的top属性，没有transition属性时，会直接定位到修改后位置上，有transition属性时，则会以某种方式移动到修改后的位置。
* 会有某些属性不支持过渡，但满足了基本位移和形变动效

#### css animation

* animation是css中的动画，它需要预设一系列状态和动画播放形式等参数，然后将其放在某一元素上。
* 比如预设一个div，宽由100(A状态)变为1000(B状态)，再变为100(C状态)，平滑线性的完成一个周期，无限循环。
* 相比transition，animation需要将状态预设好，不能随机应变，灵活性要差一些。但是，相对于固定的动画帧，animation提供了循环播放等更为全面的动画播放属性

#### 其他动画库

* ZRender
* Three.js
* 一般的动画库或者，渲染库都会提供类似API供大家实现动画

### 不简单动画/动效

这类方案也并没有想象中的复杂，也就是我们需要自己实现动画的播放器，和动画图像帧，并且不同于只预设几个状态，我们要精确到每个动画的每个帧。

#### 播放器

播放器的实现非常简单，也就是一个循环执行的函数，他负责不断的修改/切换/替换动画帧。常见一下几种方式

* while(1)，需要注意break
* setInterval，需要注意clearInterval
* setTimeout 递归，setTimeout嵌套setTimeout，相对于setInterval更加好控制一些
* window.requestAnimationFrame，要求浏览器在下次重绘之前调用指定的回调函数更新动画。该方法需要传入一个回调函数作为参数，该回调函数会在浏览器下一次重绘之前执行。相对于以上三个，这个更接近于浏览器渲染频率，更接近流畅动画。

#### 帧

帧的绘制形式有多种多样，困难点在与轨迹的计算。

##### 绘制形式

* dom，即HTML，但是既然用html为什么不用css动画呢
* canvas，画布，较为常见的绘制形式一般的渲染库都是根据canvas绘制的
* WebGL，3d，使用较为复杂，绘制3d使用，一般不使用
* 其他库，three.js，ZRender等

##### 轨迹计算

* 如果数学，物理基础知识好的话，这部分不用担心，本身就是将元素的动效抽象成一个根据时间变化的函数，单位时间内进行变化，或者传入时间间隔进行变化。
* 有了抽象模型之后，在单位时间内对元素进行改变或者对canvas进行重绘，经形成了动画

